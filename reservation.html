<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RÃ©servation - New Fiestas</title>

  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">

  <!-- Ton CSS -->
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <header>
    <h1>New Fiestas</h1>
  </header>

  <main>
    <section>
      <h2>ğŸ“… RÃ©server une date</h2>
      <div id="calendar"></div>
    </section>
  </main>

  <!-- FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

  <!-- Script Firebase + Calendar -->
  <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ğŸ”¥ CONFIG FIREBASE (REMPLACE PAR LA TIENNE)
    const firebaseConfig = {
      apiKey: "TA_API_KEY",
      authDomain: "TA_AUTH_DOMAIN",
      projectId: "TA_PROJECT_ID",
      storageBucket: "TA_STORAGE_BUCKET",
      messagingSenderId: "TA_SENDER_ID",
      appId: "TA_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.addEventListener("DOMContentLoaded", async () => {

      const calendarEl = document.getElementById("calendar");

      // ğŸ”¥ RÃ©cupÃ©rer rÃ©servations confirmÃ©es
      const querySnapshot = await getDocs(collection(db, "reservations"));

      let events = [];

      querySnapshot.forEach((doc) => {
        const data = doc.data();

        if (data.statut === "confirmÃ©e") {
          events.push({
            title: "RÃ©servÃ©",
            start: data.date,
            color: "#ff4d4d"
          });
        }
      });

      // ğŸ‰ Initialiser FullCalendar
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        locale: "fr",
        events: events,

        dateClick: function(info) {

          const clickedDate = info.dateStr;

          const isReserved = events.some(event => event.start === clickedDate);

          if (isReserved) {
            alert("âŒ Date dÃ©jÃ  rÃ©servÃ©e !");
          } else {
            alert("âœ… Date disponible !");
          }

        }

      });

      calendar.render();

    });

  </script>

</body>
</html>
